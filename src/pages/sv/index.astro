---
import { getEntry, getCollection } from "astro:content";

import Layout from '../../layouts/Layout.astro';
import Quotes from '../../components/Quotes.astro';
import Biography from '../../components/content-sections/Biography.astro';
import Contact from '../../components/content-sections/Contact.astro';
import Listen from '../../components/content-sections/Listen.astro';
import Photo from '../../components/content-sections/Photo.astro';
import Upcoming from '../../components/content-sections/Upcoming.astro';
import Header from '../../components/parts/Header.astro';
import Footer from '../../components/parts/Footer.astro';

const lang = "sv";

const mainTitle = 'Alexandra Hedin';
const subTitle = 'Sopran';

// Try to load events for this language
const eventsEntry = await getEntry("events", `events.${lang}`);
const rawEvents = eventsEntry?.data.events ?? [];

const now = new Date();

const cmsEvents = rawEvents
  .filter((event) => new Date(event.date) >= now)
  .sort(
    (a, b) =>
      new Date(a.date).getTime() - new Date(b.date).getTime()
  );

const events = cmsEvents.map((event) => {
  const date = new Date(event.date);

  const weekday = date.toLocaleDateString("sv-SE", {
    weekday: "long",
  });

  const day = date.getDate();

  const month = date.toLocaleDateString("sv-SE", {
    month: "long",
  });

  const time = date
    .toLocaleTimeString("sv-SE", {
      hour: "2-digit",
      minute: "2-digit",
      hour12: false,
    })
    .replace(":", ".");

  return {
    ...event,
    date: `${capitalize(weekday)} ${day} ${month} kl ${time}`,
  };
});

function capitalize(value: string) {
  return value.charAt(0).toUpperCase() + value.slice(1);
}

const navItems = [
    { href: '#biografi', text: 'Biografi' },
    { href: '#lyssna', text: 'Lyssna' },
    { href: '#foto', text: 'Foto' },
    { href: '#kontakt', text: 'Kontakt' },
]

// Add upcoming as the first item of the navItems array if there are events.
if (events.length > 0) {
    navItems.unshift({ href: '#aktuellt', text: 'Aktuellt' });
}

const allBioEntries = await getCollection("biography");
const bioEntry = allBioEntries.find(e => e.id === `biography.${lang}.md`);

const { Content: BioContent } = bioEntry ? await bioEntry.render() : { Content: null };

const showBioHeaderImage = events.length > 0;

const bioQuotes = [
    {
        text: '…med en röstkvalitet som är sensationellt bra. Alldeles raffinerad var hennes “Porgi amor” med en timbre som fick mig att tänka på en ung Gundula Janowitz. Även “Dove sono” sjöng hon utmärkt…',
        author: 'Sören Tranberg, Tidsskriften Opera',
    },
    {
        text: '…för kvällens vackraste röst utnämner jag Alexandra Hedin som gestaltade grevinnan, Rosina. När hon sjöng sin stora aria höll jag nästan andan för att inte missa något av den vokala upplevelsen!',
        author: 'Mogens H Andersson, Operalogg',
    },
    {
        text: 'Micaela som sjöngs av sopranen Alexandra Hedin krävde föreställningens första bravo-rop, vilket var helt välförtjänt!',
        author: 'Mogens H Andersson, Operalogg'
    }
];

---

<Layout
	title='Alexandra Hedin'
	lang='sv'
	metaDescription='Sopran Alexandra Hedin'
>
    <Header
        mainTitle={mainTitle}
        subTitle={subTitle}
        navItems={navItems}
    />
	<main>
        <Upcoming
            title='Aktuellt'
            events={events}
        />


        <Biography title={bioEntry?.data?.title || 'Biografi' } showHeaderImage={showBioHeaderImage}>
          {BioContent && <BioContent />}

          <Quotes quotes={bioQuotes} />
        </Biography>

		<Listen title='Lyssna' />

        <Photo title='Foto' galleryTitle='Bildgalleri' />

        <Contact title='Kontakt' emailTitle='E-mail' phoneTitle='Telefon' />
	</main>
    <Footer navItems={navItems} />
</Layout>
