---
import listenImage from '../../assets/aIMG_1098.jpg';
import ContentSection from '../ContentSection.astro';

export interface Props {
    title: string;
    skipLinkText?: string;
    playVideoLabel?: string;
}

const { title, skipLinkText, playVideoLabel = 'Play video' } = Astro.props;

const vimeoVideos = [
    {
        id: 1127992277,
        title: 'Deh se piacer (Vitellia) La clemenza di Tito - W A Mozart',
        customContainerStyle: ''
    },
    {
        id: 1127995118,
        title: 'Che fiero momento (Euridice) Orfeo ed Euridice - C W Gluck',
        customContainerStyle: ''
    },
    // {
    //     id: 829553989,
    //     title: 'Qual vita é questa mai… Che fiero momento (Euridice) - Orfeo ed Euridice - C W Gluck',
    //     variant: 'custom',
    //     customContainerStyle: ' aspect-ratio: 343/248;'
    // },
    // {
    //     id: 830853799,
    //     title: 'Tanto amore segreto (Liù) - Turandot - Puccini',
    //     variant: 'custom',
    //     customContainerStyle: ' aspect-ratio: 343/248;'
    // },
    {
        id: 294648968,
        title: 'Je dis que rien m’épouvante (Micaëla) - Carmen - Bizet',
        customContainerStyle: ''
    },
    {
        id: 240281788,
        title: 'Dove sono i bei momenti (La Contessa) - Le nozze di Figaro - Mozart',
        customContainerStyle: ''
    }
];
---

<ContentSection
    headerImage={listenImage}
    {title}
    maxWidth='max-w-4xl'
    sectionType='listen'
    skipToSection='photo'
    {skipLinkText}
>
    <ul>
        {vimeoVideos.map((vimeoVideo) => (
            <li class="mb-12 lg:mb-24 ">
                <h3 class="font-sans lg:text-lg mb-4">{vimeoVideo.title}</h3>
                <lite-vimeo
                    videoid={vimeoVideo.id}
                    class="[&_>_iframe]:bg-black"
                    style={`background-image: url('https://i.vimeocdn.com/video/${vimeoVideo.id}.webp?mw=1600&mh=900&q=70');${vimeoVideo.customContainerStyle}`}
                    tabindex="0"
                    role="button"
                    aria-label={`${playVideoLabel}: ${vimeoVideo.title}`}
                >
                    <div class="ltv-playbtn"></div>
                </lite-vimeo>
            </li>
        ))}
    </ul>
</ContentSection>

<script>
    // Lazy load the Vimeo embed script only when this section is visible
    // This saves ~8KB and avoids loading Vimeo resources on every page
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                // Load the lite-vimeo script
                const script = document.createElement('script');
                script.type = 'module';
                script.src = 'https://cdn.jsdelivr.net/npm/lite-vimeo-embed/+esm';
                document.head.appendChild(script);
                
                // Stop observing after loading once
                observer.disconnect();
            }
        });
    }, {
        // Start loading when section is 200px away from viewport
        rootMargin: '200px'
    });
    
    // Observe the first video element
    const firstVideo = document.querySelector('lite-vimeo');
    if (firstVideo) {
        observer.observe(firstVideo);
    }
    
    // Add keyboard support for lite-vimeo elements
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
            const target = e.target as HTMLElement;
            if (target.tagName.toLowerCase() === 'lite-vimeo') {
                e.preventDefault();
                target.click();
            }
        }
    });
</script>