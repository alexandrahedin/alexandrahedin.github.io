---
import listenImage from '../../assets/aIMG_1098.jpg';
import ContentSection from '../ContentSection.astro';

export interface Props {
    title: string;
    sectionId: string;
    skipLinkText?: string;
    playVideoLabel?: string;
    videos: Array<{
        title: string;
        vimeoId: string;
        customContainerStyle?: string;
    }>;
}

const { title, sectionId, skipLinkText, playVideoLabel = 'Play video', videos } = Astro.props;
---

<ContentSection
    headerImage={listenImage}
    {title}
    {sectionId}
    maxWidth='max-w-4xl'
    sectionType='listen'
    skipToSection='photo'
    {skipLinkText}
>
    <ul>
        {videos.map((video) => (
            <li class="mb-12 lg:mb-24 ">
                <h3 class="font-sans lg:text-lg mb-4">{video.title}</h3>
                <lite-vimeo
                    videoid={video.vimeoId}
                    class="[&_>_iframe]:bg-black"
                    style={`background-image: url('https://i.vimeocdn.com/video/${video.vimeoId}.webp?mw=1600&mh=900&q=70');${video.customContainerStyle}`}
                    tabindex="0"
                    role="button"
                    aria-label={`${playVideoLabel}: ${video.title}`}
                >
                    <div class="ltv-playbtn"></div>
                </lite-vimeo>
            </li>
        ))}
    </ul>
</ContentSection>

<script>
    // Lazy load the Vimeo embed script only when this section is visible
    // This saves ~8KB and avoids loading Vimeo resources on every page
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                // Load the lite-vimeo script
                const script = document.createElement('script');
                script.type = 'module';
                script.src = 'https://cdn.jsdelivr.net/npm/lite-vimeo-embed/+esm';
                document.head.appendChild(script);
                
                // Stop observing after loading once
                observer.disconnect();
            }
        });
    }, {
        // Start loading when section is 200px away from viewport
        rootMargin: '200px'
    });
    
    // Observe the first video element
    const firstVideo = document.querySelector('lite-vimeo');
    if (firstVideo) {
        observer.observe(firstVideo);
    }
    
    // Add keyboard support for lite-vimeo elements
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
            const target = e.target as HTMLElement;
            if (target.tagName.toLowerCase() === 'lite-vimeo') {
                e.preventDefault();
                target.click();
            }
        }
    });
</script>